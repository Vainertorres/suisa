{% extends 'base/basecvd.html' %}
{% load static %}
{% block page_content %}
	  <div class="card shadow mb-4">
                <!-- Card Header - Dropdown -->
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                  <h6 class="m-0 font-weight-bold text-primary">Listado de Usuarios reportados con Covid-19</h6>
                  <div class="dropdown no-arrow">
                    <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                    </a>
                    <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in" aria-labelledby="dropdownMenuLink">
                      <div class="dropdown-header">Acciones:</div>
                      <a class="dropdown-item"  href="{% url 'cvd:paconglomerado_new' %}"> <span class="fa fa-calendar-plus"></span>Nuevo</a>                      
                    </div>
                  </div>
                </div>
                <!-- Card Body -->
                <div class="card-body">
                  {% if not obj  %}
                        No hay Pacientes reportados con Covid-19
                  {% endif %}
                  <table 
                    data-toggle="table"
                    data-pagination="true"
                    data-search="true"
                    data-show-columns="true"
                    data-toolbar=".buttons-toolbar"
                    data-locale="es-MX"
                    data-show-toggle="true"
                    data-show-fullscreen="true">
                    <thead>   
                      <th>Fec Rep</th>
                      <th>Ident</th>
                      <th>Nombres y Apellidos</th> 
                      <th>Dirección</th> 
                      <th>Teléfono</th>                                            
                      <th>Edad</th> 
                      <th>EPS</th>
                      <th>F. Toma Mx</th> 
                      <th>Result Mx</th> 
                      <th>Estado</th>
                      <th class="all">Acciones</th> 
                    </thead>  
                    <tbody>
                      {% for item in obj %}
                        <tr>
                            <td>{{item.fc|date:"d/m/Y"}}</td>                            
                            <td> {{item.paciente.tipodoc.codigo}}:{{item.paciente.identificacion}}</td>
                            <td>{{item.paciente}}</td>
                            <td>{{item.paciente.direccion}}</td>                            
                            <td>{{item.paciente.telefono}}</td>                    
                            <td>{{item.paciente.edad}}</td>                    
                            <td>{{item.paciente.eps}}</td>                    
                            <td>{{item.fechatomamuestra|date:"d/m/Y"}}</td>                            
                            <td>{{item.resultado}}</td>
                            <td onclick='prueba()'>
                                {% if item.estado %}
                                    <i class="far fa-thumbs-up text-primary"></i>
                                {% else %}
                                    <i class="far fa-thumbs-down text-danger"></i>
                                {% endif %}
                            </td>
                            <td>
                              <a href="{% url 'cvd:paconglomerado_edit' item.pk %}" class="btn btn-warning btn-circle"><i class="far fa-edit"></i></a>
                             
                               
                            </td>
                          </tr>                   
                      {% endfor %}
                    </tbody>

                  </table>
                  <button onclick="getOutput();">Enviar</button>
                  <div class="output"></div>
                </div>
            </div>
{% endblock page_content %}

{% block js_page %}
 <script>



// handles the click event for link 1, sends the query
function getOutput() {
  

  getRequest(
      'https://sistemasmasivos.com/c3colombia/api/sendsms/send.php?user=ferneli79@hotmail.com&password=NFNtfONtJd&GSM=573122313729&SMSText=Prueba desde Suisa', // URL for the PHP file
       drawOutput,  // handle successful request
       drawError    // handle error
  );

  return false;
}  
// handles drawing an error message
function drawError() {
  alert('Hola');
    var container = document.getElementById('output');
    container.innerHTML = 'Bummer: there was an error!';
}
// handles the response, adds the html
function drawOutput(responseText) {
    var container = document.getElementById('output');
    container.innerHTML = responseText;

}
// helper function for cross-browser request object
function getRequest(url, success, error) {
    var req = false;
    try{
        // most browsers
        req = new XMLHttpRequest();
    } catch (e){
        // IE
        try{
            req = new ActiveXObject("Msxml2.XMLHTTP");
        } catch(e) {
            // try an older version
            try{
                req = new ActiveXObject("Microsoft.XMLHTTP");
            } catch(e) {
                return false;
            }
        }
    }
    if (!req) return false;
    if (typeof success != 'function') success = function () {};
    if (typeof error!= 'function') error = function () {};
    req.onreadystatechange = function(){
        if(req.readyState == 4) {
            return req.status === 200 ? 
                success(req.responseText) : error(req.status);
        }
    }
    req.open("GET", url, true);
    req.send(null);
    return req;
}

  function inactivar(id)
  {
    alert('Hola');
    var data={id:id};
    data= JSON.stringify(data);
    var token = "{{ csrf_token }}";
    //alert("data" + token);
    return false;
    $.ajax({
      headers : {"X-CSRFToken":token},
      type:"POST",
      url:"con/emp/notifpac/"+id,
      data:data,
      success:function(response){
        if(response === "OK")
        {
          location.reload(true);
        }
        else
        {
          mensaje("Error intentando cambiar el estado del Cliente");
        }
      },
      error: function(jqXHR, textStatus, errorThrow){
        console.log(textStatus, errorThrow);
        mensaje(errorThrow,'red');
        cerrar_modal();
      }
    });
  }

 
 
 </script>

 {% endblock %}

